<?php
/**
 * @file
 * Code for the Ktopic feature.
 */

include_once 'ktopic.features.inc';

include_once 'ktopic.field.inc';
include_once 'ktopic.ktype.inc';

/**
 * Implements hook_ctools_plugin_directory().
 */
function ktopic_ctools_plugin_directory($module, $plugin) {
  $modules = array('ctools', 'entityreference');
  if (in_array($module, $modules)) {
    return $module . '/' . $plugin;
  }
}

/**
 * Return list of ktopic type options.
 */
function ktopic_type_options() {
  $vocab = taxonomy_vocabulary_machine_name_load('ktype');
  $terms = taxonomy_get_tree($vocab->vid);
  $options = array();
  foreach ($terms as $term) {
    $options[$term->tid] = $term->name;
  }

  return $options;
}

/**
 * Load ktopic entity, node.
 */
function ktopic_load($name) {
  $conds[] = array(
    'column' => 'machine',
    'value' => $name,
    'operator' => '=',
  );
  $ids = KtoolsEntityField::queryEntities(KTOPIC_FIELD_NAME, $conds, 'node');

  return node_load(reset($ids));
}

function ktopic_ktopic_name($ktopic) {
  $lang = $ktopic->language;

  return $ktopic->field_ktopic_name[$lang][0]['machine'];
}
